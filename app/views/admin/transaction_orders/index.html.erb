<h1>我的订单</h1>
<div class="row">
  <div class="container">
    <% @transaction_orders.each do |order| %>
      <div class="media shopping-cart-row">
        <h4 class="media-heading">订单号: <%= order.order_no %></h4>
        <%= "订单创建时间" %>
        <%= order.created_at.strftime('%Y-%m-%d %H:%M:%S') %>
        <p>
          <span class="label <%= order.is_payed? ? 'label-success' : 'label-warning' %>">
            <%= order.is_payed? ? '已付款' : '未付款' %>
          </span>
          <% if order.is_payed? %>
            <span class="label <%= order.is_delivered? ? 'label-success' : 'label-warning' %>">
            <%= order.is_delivered? ? '已发货' : '未发货' %>
          </span>
          <% end %>
        <div class="pull-right">
            <form action="<%= admin_transaction_order_path(order) %>" method="post" id="delete-form">
              <%= hidden_field_tag :authenticity_token, form_authenticity_token %>
              <input type="hidden" name="_method" value="delete">
              <input type="submit" value="取消订单" class="btn btn-danger btn-lg" onclick="event.preventDefault(); deleteOrder();">
            </form>
        </div>
        <div class="pull-right">
          <% if order.is_payed? and not order.is_delivered? %>
            <form action="<%= delivery_admin_transaction_order_path(order) %>" method="post">
              <%= hidden_field_tag :authenticity_token, form_authenticity_token %>
              <input type="submit" value="发货" class="btn btn-success btn-lg" >
            </form>
          <% end %>
        </div>
        </p>

        <% order.transaction_items.each do |item| %>
          <div class="media-left">
            <%= image_tag item.product.main_product_image.image, style: "width: 200px; height: 200px; display: block" , class: 'media-object', alt: item.product.title %>
          </div>
          <div class="media-body">
            <p><%= item.product.title %></p>
            <p>数量: <%= item.amount %> 价格: ¥<%= item.money %></p>
          </div>
        <% end -%>
        <p>总价: ¥<%= order.total_money %></p>
        <p><%= order.address.contact_name %> <%= order.address.cellphone %> <%= order.address.address %></p>
      </div>
    <% end -%>

    <%= will_paginate @orders %>
  </div>
</div>

<script>
    function deleteOrder() {
        if (confirm("确定要删除订单吗？")) {
            document.getElementById("delete-form").submit();
        }
    }
</script>
