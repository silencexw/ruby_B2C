
<div class="row">
    <div class="col-lg-3">
      <%= render 'shared/categories' %>
    </div>
    <div class="col-lg-9">

      <ol class="breadcrumb">
        <li><a href="<%= root_path %>">Home</a></li>
        <li class="active"><%= @product.category.parent.title %></li>
        <li><a href="<%= category_path @product.category %>"><%= @product.category.title %></a></li>
        <li class="active"><%= @product.title %></li>
      </ol>

      <div class="row">
        <% @product.product_images.each do |product_image| %>
          <div class="col-xs-6 col-md-3 mb-4">
            <a href="#" class="thumbnail detail">
              <div class="image-container">
                <%= image_tag product_image.image, class: "resized-image", alt: "" %>
              </div>
            </a>
          </div>
        <% end -%>
        <% if @product.product_images.blank? %>
          <div class="image-container">
          <%= image_tag "no_product.jpg", class: "resized-image", alt: "" %>
          </div>
        <% end %>
      </div>

      <h1><%= @product.title %></h1>

      <ul class="list-unstyled">
        <% if @product.amount.zero? %>
          <li>库存: 商品已被卖完</li>
        <% else %>
          <li>库存: <%= @product.amount %></li>
        <% end %>
        <% unless @product.sizes.empty? and @product.colors.empty?%>
        <div>
          <% unless @product.sizes.empty? %>
          <div class="swatch clearfix" data-option-index="0" style="display: inline-block;">
              <div class="header">Size</div>
              <% @product.sizes.each_with_index do |size, index| %>
                <div class="swatch-element plain available">
                  <input id="swatch-<%= size.size_id %>" type="radio" name="option-size" value="<%= size.size_id %>" <% if index == 0 %>checked="checked"<% end %> />
                  <label for="swatch-<%= size.size_id %>">
                    <%= size_name(size.size_id) %>
                    <img class="crossed-out" src="//cdn.shopify.com/s/files/1/1047/6452/t/1/assets/soldout.png?10994296540668815886" />
                  </label>
                </div>
              <% end %>
          </div>
            <% end %>
          <% unless @product.colors.empty? %>
          <div class="swatch clearfix" data-option-index="1" style="display: inline-block;">
              <div class="header">Color</div>
              <% @product.colors.each_with_index do |color, index| %>
                <div class="swatch-element color available">
                  <input id="swatch-color-<%= color.color_id %>" type="radio" name="option-color" value="<%= color.color_id %>" <% if index == 0 %>checked="checked"<% end %> />
                  <label for="swatch-color-<%= color.color_id %>">
                    <%= raw get_color(color.color_id) %>
                    <img class="crossed-out" src="//cdn.shopify.com/s/files/1/1047/6452/t/1/assets/soldout.png?10994296540668815886" />
                  </label>
                </div>
              <% end %>
          </div>
          <% end %>
        </div>

        <% end %>

      </ul>


      <strong style="font-weight: bold; font-size: 24px;">¥<%= @product.price %></strong>
      <span class="msrp" style="font-weight: bold; font-size: 16px;">¥<%= @product.msrp %></span>

      <% if @product.amount.zero? %>
        <p><a href="#" class="btn btn-danger disabled">商品已售罄</a></p>
      <% else %>
        <form method="post" action="<%= cart_items_path %>">
          <%= csrf_meta_tags %>
          <%= hidden_field_tag :authenticity_token, form_authenticity_token %>
          <input type="hidden" name="product_id" value="<%= @product.id %>" />
          <% unless @product.sizes.empty? %>
          <input type="hidden" name="size_id" value="<%= @product.sizes.first.size_id %>" />
            <% end %>
            <% unless @product.colors.empty? %>
          <input type="hidden" name="color_id" value="<%= @product.colors.first.color_id %>" />
          <% end %>
          <p>数量: <input type="text" name="amount" value="1" /></p>
          <p><button type="submit" class="btn btn-primary">加入购物车</button></p>
        </form>
      <% end %>

      <ul class="nav nav-tabs mt-5">
        <li role="presentation" class="active"><a href="javascript:;">商品描述</a></li>
      </ul>
      <%= @product.description %>

    </div>
  </div>


<script>
    // 当用户选择不同尺码时更新 size_id 的值
    document.querySelectorAll('input[name="option-size"]').forEach(function(radio) {
        radio.addEventListener('change', function() {
            document.querySelector('input[name="size_id"]').value = this.value;
        });
    });

    // 当用户选择不同颜色时更新 color_id 的值
    document.querySelectorAll('input[name="option-color"]').forEach(function(radio) {
        radio.addEventListener('change', function() {
            document.querySelector('input[name="color_id"]').value = this.value;
        });
    });
</script>
